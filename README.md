# Nepal IPO Radar - Fullstack Application

A robust, fullstack application to track Initial Public Offerings (IPOs) in Nepal using Gemini AI for real-time intelligence and Supabase for reliable data persistence.

## Features
- **Live AI Scanning**: Uses Google Gemini to scrape fresh data from the web.
- **Data Persistence**: Stores results in Supabase to ensure no data is lost between scans ("Missing data" fix).
- **Automated Alerts**: Sends email notifications via Gmail SMTP when new IPOs are detected.
- **Robustness**: Merges new scan data with existing database records.

## Deployment Instructions (Vercel)

### 1. Prerequisites
- A **Supabase** account (Free tier is fine).
- A **Gmail** account with an **App Password** generated (for sending emails).
- A **Google Gemini API Key**.
- A **Vercel** account.

### 2. Database Setup (Supabase)
1. Go to your Supabase Project -> SQL Editor.
2. Run the following SQL to create the required tables:

```sql
-- Table for storing IPOs
create table ipos (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null,
  company_name text not null,
  sector text,
  share_type text not null default 'General Public',
  status text,
  units numeric,
  price numeric,
  opening_date text,
  closing_date text,
  description text,
  min_units numeric,
  max_units numeric,
  rating text,
  project_description text,
  risks text,
  source_url text,
  
  -- Create a unique constraint to prevent duplicates
  constraint ipos_company_share_unique unique (company_name, share_type)
);

-- Table for email subscribers
create table subscribers (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  email text unique not null
);
```

### 3. Environment Variables (.env)
When deploying to Vercel, go to **Settings > Environment Variables** and add the following:

| Variable Name | Description |
|ry | --- |
| `API_KEY` | Your Google Gemini API Key |
| `VITE_SUPABASE_URL` | Your Supabase Project URL |
| `VITE_SUPABASE_KEY` | Your Supabase Anon/Public Key |
| `GMAIL_USER` | Your Gmail address (e.g., `you@gmail.com`) |
| `GMAIL_APP_PASSWORD` | The 16-character App Password generated from Google Account Security |
| `ALERT_RECIPIENT_EMAIL` | The email where you want to receive alerts (e.g., `you@gmail.com`) |

**Note:** `VITE_` variables are exposed to the browser. The others are backend-only.

### 4. Deploy
1. Push this code to GitHub.
2. Import the repository in Vercel.
3. Vercel will automatically detect the `api/` folder and deploy the serverless functions.
4. Add the Environment Variables listed above.
5. Click **Deploy**.

## Local Development
To run the full stack locally (including the API):

1. Install Vercel CLI: `npm i -g vercel`
2. Run `vercel dev`
3. This will start the Vite frontend AND the backend API function at `localhost:3000`.

## How the "Robustness" Works
1. The app first loads data from the **Database**. This ensures that even if the AI scan fails or returns partial data, you still see the last known good state.
2. When you click **Scan**, the AI fetches new data.
3. New data is **Upserted** (merged) into the database. Existing records are updated; new ones are added.
4. If a new IPO is added, the `/api/notify` endpoint is called to send an email.
